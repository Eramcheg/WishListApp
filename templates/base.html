{% load static %}
{% load widget_tweaks %}
<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
  <meta charset="UTF-8" />
  <title>{% block title %}Wishlist{% endblock %}</title>

  <script src="https://unpkg.com/lucide@latest"></script>
  <link rel="stylesheet" href="{% static 'css/styles.css' %}">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="icon" type="image/x-icon" href="{% static 'icons/favicon.ico' %}">
  {% block extra_meta %}{% endblock %}
</head>

<body class="bg-bg text-text min-h-screen">
    <!-- NAVBAR -->
    <nav class="bg-accent text-white shadow mb-6">
        <div class="max-w-6xl mx-auto px-4 py-3 flex items-center justify-between">
          <a href="/" class="font-bold text-xl hover:opacity-90">üéÅ WishList</a>

          <div class="flex items-center gap-6">

            {% if user.is_authenticated %}
              <span class="opacity-90">Hi, {{ user.username }}</span>

            {% else %}
              <a href="{% url 'login' %}" class="hover:opacity-90 mr-2">Login</a>
              <a href="{% url 'register' %}"
                 class="bg-white text-accent px-3 py-1 rounded font-medium hover:opacity-90 transition">
                Sign up
              </a>
            {% endif %}
          </div>
        </div>
    </nav>


    <!-- PAGE CONTENT -->
    <main class="max-w-6xl mx-auto px-4">
        <div class="max-w-6xl mx-auto px-4 py-6">
          {% block content %}{% endblock %}
        </div>
    </main>

    {% include "partials/sidebar.html" %}
    <div id="toast-root" class="toast-wrap" aria-live="polite" aria-atomic="true"></div>

</body>
<script>
    lucide.createIcons();
        (function () {
          const root = document.getElementById('toast-root');

          function iconFor(type) {
            const map = { info:'info', success:'check-circle', error:'alert-triangle' };
            return map[type] || 'info';
          }

          // –°–æ–∑–¥–∞–Ω–∏–µ DOM —Ç–æ—Å—Ç–∞
          function createToast({ type='info', title='', message='', duration=6000 }) {
            const el = document.createElement('div');
            el.className = `toast toast--${type} toast-enter`;
            el.setAttribute('role', type === 'error' ? 'alert' : 'status');
            el.style.setProperty('--toast-duration', `${duration}ms`);

            el.innerHTML = `
              <div class="toast-progress"></div>
              <div class="toast-row">
                <span class="toast-icon"><i data-lucide="${iconFor(type)}" class="w-5 h-5"></i></span>
                <div class="min-w-0">
                  ${title ? `<div class="toast-title">${title}</div>` : ``}
                  ${message ? `<div class="toast-desc">${message}</div>` : ``}
                </div>
                <button class="toast-close" aria-label="Close" type="button">&times;</button>
              </div>
            `;

            root.appendChild(el);
            requestAnimationFrame(() => {
              el.classList.add('toast-enter-active');
              setTimeout(() => el.classList.remove('toast-enter','toast-enter-active'), 220);
            });

            el.querySelector('.toast-close').addEventListener('click', () => closeToast(el));
            let remaining = duration, started = Date.now(), timer;
            const progress = el.querySelector('.toast-progress');

            function startTimer() {
              started = Date.now();
              progress.style.animationPlayState = 'running';
              timer = setTimeout(() => closeToast(el), remaining);
            }
            function pauseTimer() {
              clearTimeout(timer);
              const elapsed = Date.now() - started;
              remaining = Math.max(0, remaining - elapsed);
              progress.style.animationPlayState = 'paused';
            }

            el.addEventListener('mouseenter', pauseTimer);
            el.addEventListener('mouseleave', () => {
              if (remaining > 0) startTimer();
            });

            startTimer();
            if (window.lucide) { window.lucide.createIcons({ icons: window.lucide.icons, attrs: {}}); }
            return el;
          }

          function closeToast(el) {
            el.classList.add('toast-leave');
            setTimeout(() => { el.remove(); }, 220);
          }

          window.addToast = function({ type='info', title='', message='', duration=6000 } = {}) {
            return createToast({ type, title, message, duration });
          };
          window.toast = {
            info:    (msg, t='Info', d=6000) => addToast({ type:'info',    title:t, message:msg, duration:d }),
            success: (msg, t='Success', d=4000) => addToast({ type:'success', title:t, message:msg, duration:d }),
            error:   (msg, t='Error', d=7000) => addToast({ type:'error',   title:t, message:msg, duration:d }),
          };
        })();

</script>
{% if messages %}
    <script>
      (function () {
        {% for message in messages %}
          addToast({
            type: "{% if 'error' in message.tags %}error{% else %}info{% endif %}",
            title: "{% if 'error' in message.tags %}Error{% else %}Info{% endif %}",
            message: "{{ message|escapejs }}",
            duration: {% if 'error' in message.tags %}7000{% else %}5000{% endif %}
          });
        {% endfor %}
      })();
    </script>
{% endif %}
{% block extra_js %}

{% endblock %}
</html>
